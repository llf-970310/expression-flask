<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="UTF-8">
    <title>首页</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static',filename='lib/layui/css/layui.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static',filename='css/main.css') }}">
</head>
<body>

<div id="body">
    <div id="form" class="layui-form layui-form-pane">
        <div id="login-title">表达能力测评</div>
        <div class="layui-form-item">
            <label class="layui-form-label">姓名</label>
            <div class="layui-input-block">
                <input type="text" name="name" required lay-verify="required" placeholder="请输入姓名"
                       autocomplete="off" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">学号</label>
            <div class="layui-input-block">
                <input type="text" name="student_id" required lay-verify="required" placeholder="请输入学号"
                       autocomplete="off" class="layui-input">
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">密码</label>
            <div class="layui-input-block">
                <input type="password" name="pwd" required lay-verify="required" placeholder="请输入密码"
                       autocomplete="off" class="layui-input">
            </div>
        </div>

        <div class="layui-form-item">
            <button class="layui-btn layui-btn-normal layui-btn-fluid" lay-submit lay-filter="formLogin">登录</button>
        </div>
    </div>

</div>

<div id="support-info">
    <small>语音识别核心技术由科大讯飞提供</small>
</div>

</body>

<script type='text/javascript' src="{{ url_for('static',filename='lib/layui/layui.all.js') }}"></script>
<script type='text/javascript' src="{{ url_for('static',filename='lib/jquery/jquery.min.js') }}"></script>
<script>
    console.log(layer);
    layui.use(['form', 'layer'], function () {
        let form = layui.form;
        let layer = layui.layer;

        //监听提交
        form.on('submit(formLogin)', function (data) {
            $.post("/api/auth/login", data.field).done(() => {
                window.location.href = '/welcome';
            }).fail(e => {
                try {
                    let response = JSON.parse(e.responseText);
                    console.log(typeof response);
                    if (response['needDisplay']) {
                        layer.msg(response['tip']);
                    } else {
                        layer.msg("服务器出错了");
                    }
                } catch (e) {
                    console.log(e);
                    layer.msg("服务器出错了");
                }
            });
            return true;
        });
    });
</script>

</html>
